
WITH teoh_jun_ling_merchants AS (
    SELECT merchant_id_nk
    FROM ocd_adw.d_merchant
    WHERE city_id = 13
        AND merchant_id_nk IN ('1-C4B1BA22JX5XLE', '1-C7ADVKMYMAD3TX', '1-C7BUJLJJHGAJJA', '1-C4CBT6A1A4E3TX', '1-C6JERYKCNP6CNN', '1-CY4BJ4CCGNMVCT', '1-C63FEF6WLTEBN6', '1-C62BAVLCSFXJRN', '1-C7BDSELTNPLXAA', '1-C4CBRKUFTBCALX', '1-CZEXHFV1RBUVCJ', '1-C2UHGA3HLYXJTA', '1-CYVVJGKZV2MGN6', '1-C22DJNLFVPJFBA', '1-C3KWRJLKRELCHA', '1-C22EPAA2N3V1G2', '1-C2VDGJ3HTX2JNN', '1-C3TBA3DHRAJ1CN', '1-C32TSE4ANNXAVN', '1-C7EEDFBAEPMYVE', '1-C7BENXJZRYMEL2', '1-C4BECJWEKFE2PE', '1-C3W2VCNZEEUYE6', '1-C32UNJJGGKJ2R6', '1-C23HHFKJBBMXAN', '1-CZJGMBTZNP5KLN', '1-C4CBRKUFTNTBGA', '1-CZEWG8C2LFJGL6', '1-C2XCJYNFJZNTVA', '1-C2JYRANELB43NA', '1-C3D2RF2HAPUXNN', '1-C36GTP2UEJMUJJ', '1-C2NCVCBHRTECE6', '1-C2XBMEX3VBXZKE', '1-C2UBENKJJYCAGX', '1-C65KGJECR6AVC6', '1-C4NVMELUDGDCAX', '1-C2AKJFAYT7MVTA', '1-C7MJWEM3NF3ACX', '1-C23CANXEEKT2J6', '1-C3TBA3DHN3CWNN', '1-C3WJG6W1VVKTHA', '1-C2UBEGKHJFA2V2', '1-C6XFKBVYEGBTEJ', '1-C6UFRKTDCVDFVA', '1-C26HTPXCGNDUEE', '1-C7A3HANZDE5YJT', '1-C3TGG4JAARBXT6', '1-C62YR2XDTTCDTN', '1-C6NAR2LHG3UHEA', '1-C3E2GY2DT243NT', '1-C7DWRBBGRBTCNN', '1-C2XAPENZJNMVE2', '1-C7CYRLLGGUBBPA', '1-C2TDR4BEALMXAN', '1-C34XCXAWR4DCME', '1-C2BVLCMKNNCHCA', '1-C2THE8KXBGKGJT', '1-C34ZLNUWRCACT6', '1-C2WGV23HNEMEJ2', '1-C7CJSEWUJUEGWA', '1-C2KFCJ2WAK5DLA', '1-C6MKBCBYMFXFSA', '1-CZJFAXDUKBTUGX', '1-C3KKEPTZGLN3FA', '1-C33AKCLUKEAGA2', '1-C6T2CYCWNAXCCA', '1-C7CCN63KREDBJX', '1-C4B2N3LXT4AJFA', '1-C3EELCLYG4KTNA', '1-C26WVZAULKNEGE', '1-C3ECCN6XLTMVTE', '1-C25GCXXJCAXAGT', '1-C3UAVPXART3DRE', '1-C6CTGN2ZSCBHTJ', '1-CZCGR2NZTB6WDE', '1-C6CEJ3KZVPLBDE', '1-C6CTJ3XULFLXFE', '1-C2MKWBJ3J35DC6', '1-C22CWAWXVNNTCN', '1-C7A1RP5KLTDTAA', '1-C3NHDAM2VPNAGA', '1-C35CNAUGAXXUTT', '1-C6XZRNAGNP5ARN', '1-CZLKAUNTSCCZNJ', '1-C4L2CVNGCCC2RT', '1-CY6EN7THCLCWC6', '1-C6UDFEC2CEKCL2', '1-C65GLCL3ALLYNE', '1-C2DJEBWEEUCBN6', '1-C66HFA6HAFU1HE', '1-C3MERBEJLLBZAE', '1-CY43NU3CSF4DE6', '1-C3UBVUDYUGAJNA', '1-CZKHC8J1EVEXEN', '1-C2EHTFL1GT4AAA', '1-C22CVFLZNPNKFA', '1-C6VAKBXTA76JCJ', '1-C63CPBVVLJT2TA', '1-C24JR3EETUKYEE', '1-C3EGCNDKT3L3GX', '1-C6WURUM2CFJVGE', '1-C3WVBAEVNRJ1RN', '1-C2XAPEKJC3JJGJ', '1-C2NYTRKCN6MZME', '1-CYLBTCAFN74JC6', '1-C32XHAK2R4LFR6', '1-C2BERJNZV2UUE2', '1-CZD1A7NASAJ3GX', '1-C2DXV6WCJK6CFE', '1-C3MEWE21RT4DA6', '1-C2WKCZKJUAW3JX', '1-CZDEDB6FERB1LT', '1-C23DL8KJKF62L6', '1-C36ZGX2EFGCAVE', '1-C4EGVX3ZJY2TRA', '1-C3VFAUEZCA6TJ2', '1-C6CHVY3WA7ADBE', '1-C64ATF5BUFM2EE', 'MYDD12690', '1-C4KKJEEEWBWYJJ', '1-C62AEJDXGJKFV6', '1-C651BFJBEABKEA', '1-C3NCAUE2ERMFVT', '1-C2LJJRN3N3NYFA', '1-C4EEL3UHLGCCUA', '1-CY3YJ2JCR8NZDA', '1-C4KHEAJYPFMJJT', '1-C2EBRLEJNPJTJX', '1-C3L1DE2BUGJASA', '1-C4EGGX3YHE61R2', '1-C4MYDCMBGA3URA', '1-C2U3AFMBRBEKEN', '1-C6VAJ2DACJLTVX', '1-C22TVT6GAJWGFA', '1-CZKCDEAUSCADLJ', '1-CZDYLJ62G33VJJ', '1-C2VXNFKTR73YBA', '1-C2WXTZNHCY41GA', '1-CZAXC7KHC2WEAJ', '1-C3EHVX3FCBEJAA', '1-C3UFKBKGE2EYEJ', '1-C22ZC6DUA7BVV6', '1-CYVFTENUSF5CR2', '1-C3LUAP4KL7XHPE', '1-C2KXRGMFCCDALN', '1-CYV1R8MZBB4KWE', '1-C6VXDCNUNTKBTX', '1-C24BCCJUAE23KE', '1-C6WZUE4XBAWXNE', '1-CYNEATVWGLLTTA', '1-C4JWGTXFLBUAJN', '1-C7BYRRAZEZDYNA', '1-C7ABGZBJGUKTVJ', '1-C6XKSFEYRXWHRX', '1-C6VKUE3ART5EME', '1-C2DXBFNWL8NWGX', '1-C6WJA2NDVY5UTT', '1-C3XZCF3HA7C3G2', '1-C23JJ6AEFB6UNA', '1-C2WYT33JATEALJ', '1-C6B2E2KERF5HKE', '1-C6NYRAKFVP3TNJ', '1-C6AJC7W1G74GAA', '1-C2E1GFDBTT5EBE', '1-C4EWARAZE62KNA', '1-C7CJSEWVAFLZHA', '1-C3NXGCJ3MCLYRX', '1-C7DEDCMYMBTYL6', '1-C6AKATKKAYBENA', '1-C65JE7TXGYAEG6', '1-C3NZRJDKE7AARJ', '1-C3VAA7WUJZMVCX', '1-C7AVG7B1HCJVJ2', '1-C24CA6CGCYWUUE', '1-C7KCVNDZAU5FRN', '1-CZMZNA5JDFM3VJ', '1-C3KWN62EJ6EYRE', '1-C32KA3J1DBLZPA', '1-C6KGHENDL3EFEN', '1-C32BLLDFJGDXLT', '1-C4D2HBUEVJAVVA', '1-C4KVA721CXADNJ', '1-C7DVCJWFKECEMA', '1-C3AFWF3TLALXCJ', '1-C2T3CY31AREXLA', '1-C26FFEX1RAKFTT', '1-C62HARBFJCKDGE', '1-C22TTZNHJPCAJN', '1-C6NYSGJXE3TCHE', '1-C66XCY6TRJTHPA', '1-C62CTRBXRKJXNJ', '1-C2DWGXJBSED2BA', '1-C6T3NBMTA7LTKA', '1-C65JETB1N34EEJ', '1-C63FVE5JGKVAAX', '1-C33HC2EYTXDZJ2', '1-CZKTLRA1GXAWBE', '1-C7MWUA2GNAJJN6', '1-C2TYAETJSCBYME', '1-C7C3ANWXJYMTCJ', '1-C26BTVEGPF5ZLE', '1-C3XFSF2XABD1LE', '1-C62YSGJAR24ZGX', '1-C7A3J73WNTU2NX', '1-C2U2EEKJMCBFEA', '1-C2UBENLZTK6JN2', '1-CY3KJJAGRPTASE', '1-CYUURJEAEZNTPE', '1-C6WHDBMTHBMEN6', '1-C62WCN4ZGBJAGN', '1-C2K1A2A2R7B2JA', '1-C7AWFFWHA26FWA', '1-C3EXAALVKEJXT6', '1-C3XWRTEZN7EASE', '1-C7LFJTVBG7KCC2', '1-C26ZKCJTT2TBPE', '1-C6XYTJWZC4EUVE', '1-C2DWC3JXLRC3TN', '1-C66WLEBWRUEGCJ', '1-C2CTA6UZACLXCN', '1-C7AFJKW3V2KFLE', '1-C242G3E2EVDFJX', '1-C26ZKCJTTP3HLJ', '1-C64KJJLHVYC3CJ', '1-C4DXVTKEVF6VAT', '1-C3MEAJJAENXZLA', '1-C6AHVKC3AYMCAX', '1-C36AUBKKLNTJAN', '1-C3KXNCDUL241WE', '1-C63WVBK1UGMHJJ', '1-C36CNP3JLLLUCA', '1-C7AFNB5BAKKXLN', '1-C6MFKBVKMF2GNX', '1-C6D1AY5DJPBWA2', '1-CZJHELN2CEM2SA', '1-C34ACXATLJ5WTX', '1-C7AGFEMUCJUXAA', '1-C6A3GVNBAXJGGX', '1-C7NGV7MHPFBESA', '1-C3BUAE3YJ2XJT6', '1-CY6EN7THA25KCE', '1-C4JDNEWXRAAURX', '1-C6JZGUNTBGMYV6', '1-CZD1EEKZTEK1TE', '1-C63AVB2TL4LWEA', '1-C32WNEWZSAAVC6', '1-C6TZDF5YAJ2KN6', '1-C2WEAEKJLJLYJE', '1-C3CKVVECV7EVEE', '1-C23KBGMHLEWZJ6', '1-C6EUTBXHNYC2GT', '1-C3WKGJD2T6UWLJ', '1-C7ECLGCHAN6WPA', '1-C2EHTFL1E7DJAX', '1-C2WEJNKJE4JKC6', '1-C7LKPENWL2CUE2', '1-C2NYA7C2LZJWTA', '1-C36FCNW1JZNFHE', '1-C22ZV4ACUF6XLA', '1-C6WKCTKZNBLZLX', '1-CY2HTKVFUABTLJ', '1-C23HGEKJUF5CVA', '1-C6W2JTMFNEBDTJ', '1-C7DZJNBFRACWG2', '1-C4J1ENMAVCAERN', '1-C7CBTUJ3AU3JDE', '1-C7C3AB2VUGACGT', '1-C3BFSFUJVJ6WRT', '1-C7KFRNEHLX2WCJ', '1-C3JCRATJCLMULJ', '1-C26FAX3JLP6XR6', '1-C23EL23KDCKATJ', '1-C64WRF5VEXKTVT', '1-C6JZC32HJGA2ET', '1-C4MYGJNBC7LZE6', '1-C7AFMAVFRBAWFE', '1-C3LBJEX1V7XDGX', '1-C3LTUAJTNBC3LJ', '1-C25AT2KKVN5BCN', '1-C6AWGAM3EZEDJX', '1-C4KXRVM1RFVBVJ', '1-C3KWNFBWNFTCR6', '1-C3BARPTAHEJCA6', '1-C2VEGCCCKEVGVJ', '1-C66YE7B3JXJUAN', '1-C7ADRJL3GJAGAN', '1-C3LALLEEG35ZT6', '1-C2KDKFNEFBCCVE', '1-C4BZVRAGL7XXEE', '1-C3L1CY4TJ3VWLT', '1-CZDBLUWELNVXL6', '1-C7CYJ733AN52E6', '1-C33WJP3TT6TGJ6', '1-C24AC6XFN7TVV2', '1-CZAYAAEXE7BCKE', '1-C7LYR22ZN7VEME', '1-C6TUWB3GV63GKE', '1-C2XHGLJCV8CZE6', '1-C362VUKDJ6UZJ2', '1-C62JTBKTA6D3BA', '1-C7KZRJA3LRBKLA', '1-C6KYUFB2C7JKR2', '1-C65CGUMTNXJDCX', '1-C26DJ6EZVJACWE', '1-C4DWG6EEG7AGJX', '1-C25WDFXGVY5ENT', '1-C7KXJKUFTXDEFA', '1-C26FFEX1REXFEN', '1-C6VHJJLTTCDHRT', '1-C7MAVN5KSAAECN', '1-C25ELCJXVXX2NT', '1-C3KDJVMVFF52KA', '1-C7BJVZAXLYWBBA', '1-C26HNJLDHAAUEJ', '1-C32GNNAGGE6DNT', '1-C7EFVLLWTBXCJA', '1-C7EDDF5TGUCVE6', '1-C2UHSA41LXUCHA', '1-C7KVMEDAEEBKAE', '1-C221N2AVJKAUGN', '1-C7JKC3LYJ3EXNT', '1-C7MXCVMGEPUDEE', '1-C6TGRTNZCAE1GT', '1-C64FCE5GRUCGRN', '1-C2BWNUJHLA4AN6', '1-CYLYRN2XN7BYVT', '1-C7BENRBUNA2DRT', '1-C7AER8KVGF5DGN', '1-C65JJ3MXJJKYNA', '1-C2LHRBACEJABRA', '1-C7CJNKNBLLETKA', '1-C6T2UBTGCTEZVA', '1-C2VUJPKJETXZET', '1-C7A3JBXJDAM1NE', '1-C4LXJ3MXT3AJME', '1-C6JXETBFDA3YAJ', '1-CZDHSEEZLJCGLX', '1-C22GJ8KJEZJAGE', '1-C3MAG2JXV63WET', '1-CZJ2NJEENTAKC6', '1-C7KCAUCVE6DWLE', '1-C6T2UF5KV3BTJE', '1-C6DVCAWAJLLDAT', '1-C65DC66ZT7TVV2', '1-C2WXTACKJ4CURT', '1-C7DUECKURCDYEE', '1-C4A3NY4TCKLWR2', '1-C23WLALJE6AZNX', '1-C62CTRBXRKBAPA', '1-C23HEFVGGJWDFA', '1-C6DWN25GGJLVR2', '1-C3EBAF4ULPVVR2', '1-C3KAR2EHN7AVV2', '1-C2U1EBAKWAMEE6', '1-C4KYLYWKKFDFN2', '1-C7ETA6XANVBFEX', '1-C2THE8KXE6KCT6', '1-C66XGVE2J24FRE', '1-C7CVFAKHTAMJJA', '1-C7LJAXCTT3ECNX', '1-C4AERX2WA26DLJ', '1-C6XXVF5ZE8KYCA', '1-C3ETJ2EYRAEXFE', '1-CYLZPCJAEGA1ME', '1-C65ALN3GCNU3C2', '1-C3ETJP3GHFLDTJ', '1-C4DVLGBVFCAVR6', '1-CY6YWEN1BALBNJ', '1-C3DGHE2YJXLFFE', '1-C3WKHAE3V7JBJA', '1-C4AUTCJJT3T3EE', '1-C7JWPFKFTAEGT6', '1-CZDKECDXEZLER6', '1-C2WWJ33JLJ5VJX', '1-C25EKBJDUA5AGN', '1-C341LJUEA231RX', '1-C3X1DBEZMB52LX', '1-C7EFVPCVVTNEEX', '1-C2UBGK4YMATTCX', '1-C6XVEBN2LCEUUE', '1-C661TTVUAX3XRN', '1-C7LFL8BBBFWZTA', '1-C6UCJAVYVJTVTJ', '1-C6MCVBVFGTEETX', '1-C7BKMAKDRJCDNJ', '1-C32AKBD1SEWJNA', '1-C7LGJX3YCKXHAX', '1-C4MZANKUCBVYL6', '1-C4AGN2KBAXVCSA', '1-C66FR7XTAJUUJX', '1-C3TCTFXAATBFNE', '1-C7KZRJAAEZC2LT', '1-C3X1VLDUSA31UE', '1-C4CFN2JDJT4CJX', '1-C4LYJNUKAAEBT6', '1-C4KWSFB3EF6FR2', '1-C6TFT3MZHFUCGE', '1-C3CYV2LHT35DAN', '1-C6XXVLJ3BAV2T2', '1-C7CWVLC1UB21HA', '1-C66JG24XRRCXCX', '1-C36AUF3YGBCUT6', '1-C7C2BAM1R3CJGT', '1-CZKWWE2DC2AJKE', '1-C3XKCUJYGUCFHA', '1-C3X3L6X1J6L3TA', '1-CZMTFCLJCCDJBA', '1-C25ZG73YV6CHMA', '1-CY5FNLDVECKVPA', '1-C7ETFFTXG36WVJ', '1-C4CKJBJBRUWZLJ', '1-C3LXL3EUA2TJNT', '1-C25UELJCG3EHCJ', '1-C7DVCY5EJ6U3JJ', '1-CYLZPCEYLAU2EE', '1-C6V3LUJBFA4WNA', '1-C7MTPCDETULGTT', '1-C7BKRALVVY6TJX', '1-CZKDTBVUTJDWEA', '1-C22VG64CCUEAFA', '1-C3UHTP2GJXWBV6', '1-C4CESBKXAECGVJ', '1-C24JCXWWV24TLN', '1-C35XR3LJFF6UTN', '1-C7CWAX5CRTTJTX', '1-C7JGJYBTE7DEVX', '1-C6KWGXACV7T2RA', '1-C2WXJ23JJYWFVX', '1-C7DUA3XUWFDKR6', '1-C2UFGJ3HL64AA6', '1-C4BFNN42DBNFE6', '1-C66HG3K2A3MKCE', '1-C2XBHB3HWADHVT', '1-C6TFWBNVTNX2GE', '1-C2KYG2UAJTLDEE', '1-C3CXDGAELX6DWA', '1-C6CHAJJVR25VV6', '1-C4AFAFXZEUAEV2', '1-C32TRNW2V3B2CE', '1-C6AUN2LJENJBRX', '1-C63VC3NFT26FTT', '1-C2UFELJ2L7BGUE', '1-C2XXGELXCJ6WAT', '1-C3JCR2EDNP43NA', '1-C7CYR32ZR7KGE6', '1-C7AWEFJAGPBTVT', '1-C3DKRLJJJNAZME', '1-C23EN7DTGBJAWE', '1-C2TBSCDUE7MXG6', '1-C7AERX3GCX2XGX', '1-C7NJLUNJG6CAGE', '1-C4B3MCNJCJCYT6', '1-C6LAFGCUVGLVG6', '1-C4BETLKDLJDWNE', '1-C23HEFUAWAXYLJ', '1-C2KYG2UAE3WET6', '1-C64HLKEUCK2FR2', '1-C242FALYVTUWNE', '1-C3TKN4DVTZBWUA', '1-C362AY2JNALVRJ', '1-C3VDJ62AVJ4CLN', '1-C7BENAKAVE2GL2', '1-C3LTV731VVLUJA', '1-C25VWE3BNKVUEX', '1-C3WCRCEBJ8D2E2', '1-C6DTCUKDJXEHKE', '1-C36HNX23JAEDKA', '1-C65EVTTTGN2EL2', '1-C3XXJ2ECJUUTVN', '1-C26YG6WTCXWURX', '1-C6NWCJE3R73VJA', '1-CZJTTKDWRX2BVA', '1-C33WJE6AA3MJGE', '1-C65XJT3GV2UHCX', '1-CZEYJBCEKEU2JX', '1-C6XFG3TKJ353EN', '1-C653LF4DG8M1GT', '1-C7CXAE22EGMBR2', '1-C63JREB1R24YGE', '1-C2MTBEKATZBUSA', '1-C3VHT3LKAFKXG2', '1-C24WC4E1LXM1E2', '1-C64GT76CVUJTEA', '1-C3XFN8AVNUUFTJ', '1-C3D2GZACVNAYTX', '1-C4EKRE6FEB3WAJ', '1-C7CHRP6CG8LXJA', '1-C6DGCLC2NJWVEE', '1-C7MYALAGDAA2UA', '1-C2DYTRCJTX31ME', '1-C36GVY3DTNTKWA', '1-C2VYNVCGNBB1AX', '1-C4ADEF3WLE6TNT', '1-C6JDV73ZRYCFRX', '1-C7AEPE52G4NXJJ', '1-C65WNXUVDCJBLE', '1-C2XHNXKKC3BXGE', '1-C4LVALNJAPCBHE', '1-C6WWKBVKNJ4JCA', '1-C4AADAJ2AXXXL6', '1-C24BCN2DL36DDE', '1-C62KLECVRRNWNX', '1-C7KZAPJFNX6XLA', '1-C7EGNTN1EUDTG6', '1-C7CDJTTDEXBBCT', '1-CZJTRAEYMFVBR2', '1-C3XETCBAEF53JN', '1-C3EEPCMAAALJGT', '1-C7ADTLNTRJ3CAE', '1-C6NYPEN2TUTZJN', '1-C26KLTVTNA4ECA', '1-C25YN4JUBEKXWE', '1-C2MHKE4ZLRJDUE', '1-C7ABEXEECY5EUA', '1-C3WBRVJTTVA1JA', '1-C23BDEKKJY6DFA', '1-C7KCVFXXC7B1RE', '1-C6MUJFTZBCDBR2', '1-C4CBG3WAAUCXL6', '1-CZB2WCD2J3MTLA', '1-C4ABGCKTEYTXLN', '1-C7LTR6DXVAVART', '1-C63YKCDJHE5EJN', '1-C34BFFXKRKBUV6', '1-C65DCVEGA7UDGJ', '1-C7CCNE6CNPKHUA', '1-C7MKUE3VNVA3AA', '1-C2AAL8CYEJTKDA', '1-C7LUJJAHNJTATE', '1-C3B2TE3DAXNHL2', '1-C4L2KF3FLJ33SA', '1-C7CJSEWULJEVSA', '1-C7DVSE6YJXAGRX', '1-C3UJR2EFSFVKL2', '1-C242KBXUGEVWET', '1-C35EJCMZT2UJNT', '1-C63JLF3XCFVJLJ', '1-C4DXC73KEJ5AVE', '1-C35ELGB3LAADGJ', '1-C65ZEN3UC4E1CT', '1-CZAWEKTYNFUYAT', '1-C4KHTXLXHBCUSE', '1-C222L23JTNVAL6', '1-C7ACBCMTRAEXGT', '1-C62ZJCLUNNXHV6', '1-C32ZBFXDRN5GAX', '1-C2L3LBW2TPL2LT', '1-C7DVWBMGRGMYPE', '1-C3CZR743CX5AKE', '1-C63CJ4NCN7WUJX', '1-C7CYRTKETEWGN6', '1-C261GF23AEWKVE', '1-C65BGVJWUABYAT', '1-C7CJNAKCAKT1CN', '1-C661TTVTV72ECT', '1-C36GTE2ZG2DHRE', '1-C2THE8KXJ243N2', '1-C65JLFLDRNMHKA', '1-C62HAKM1PA5WG2', '1-CZB2WCD2JUMAL2', '1-C7CYR8MGDFB1RT', '1-C7BYTN23DAU1UE', '1-C3KHN2EJLFCHHE', '1-C63FGKVENLACLX', '1-C7AULY3ZELBGE2', '1-C3E1KA6JRKT1LN', '1-C6XKTTUYN6CUL2', '1-C4B2N3LXTTCGN6', '1-C4JYLE5AG74FCE', '1-C2XWSFKJBABGHE', '1-C6NYRP4CJ4DHLA', '1-C2CZVT4DHBAXLJ', '1-C3NTAEXACBUXCN', '1-C2B1VVKHVKVYWA', '1-C6WCCY3TUEE2T6')
),
monthly_gmv AS (
    SELECT 
        CAST(SUBSTRING(CAST(f.date_id AS VARCHAR), 1, 6) AS INTEGER) as month_id,
        COUNT(DISTINCT f.merchant_id) as unique_merchants,
        COUNT(DISTINCT CASE WHEN f.booking_state_simple = 'COMPLETED' THEN f.order_id END) as orders,
        COUNT(DISTINCT CASE WHEN f.booking_state_simple = 'COMPLETED' THEN f.passenger_id END) as unique_eaters,
        SUM(CASE WHEN f.booking_state_simple = 'COMPLETED' THEN f.gross_merchandise_value ELSE 0 END) as gmv
    FROM ocd_adw.f_food_metrics f
    WHERE f.city_id = 13
        AND f.country_id = 1
        AND f.date_id >= 20250501
        AND f.date_id < 20251101
        AND f.business_type = 0
        AND f.merchant_id IN (SELECT merchant_id_nk FROM teoh_jun_ling_merchants)
    GROUP BY CAST(SUBSTRING(CAST(f.date_id AS VARCHAR), 1, 6) AS INTEGER)
),
total_penang_gmv AS (
    SELECT 
        CAST(SUBSTRING(CAST(f.date_id AS VARCHAR), 1, 6) AS INTEGER) as month_id,
        SUM(CASE WHEN f.booking_state_simple = 'COMPLETED' THEN f.gross_merchandise_value ELSE 0 END) as total_penang_gmv
    FROM ocd_adw.f_food_metrics f
    WHERE f.city_id = 13
        AND f.country_id = 1
        AND f.date_id >= 20250501
        AND f.date_id < 20251101
        AND f.business_type = 0
    GROUP BY CAST(SUBSTRING(CAST(f.date_id AS VARCHAR), 1, 6) AS INTEGER)
)
SELECT 
    mg.month_id,
    'Teoh Jun Ling' as mgs_name,
    mg.unique_merchants,
    mg.orders,
    mg.unique_eaters,
    mg.gmv,
    tp.total_penang_gmv,
    ROUND(mg.gmv * 100.0 / NULLIF(tp.total_penang_gmv, 0), 2) as gmv_pct_of_penang,
    ROUND(mg.gmv / NULLIF(mg.unique_merchants, 0), 2) as avg_gmv_per_merchant,
    ROUND(mg.gmv / NULLIF(mg.orders, 0), 2) as avg_gmv_per_order,
    ROUND(mg.gmv / NULLIF(mg.unique_eaters, 0), 2) as avg_gmv_per_eater
FROM monthly_gmv mg
INNER JOIN total_penang_gmv tp ON mg.month_id = tp.month_id
ORDER BY mg.month_id;
